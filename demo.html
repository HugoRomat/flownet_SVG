<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <link rel='stylesheet' href='css/style.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
    <script src='lib/flownet.js'></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
  <body>
    <div class='mainDiv'>
      <div class='leftContainer'>
        <div>
          <div class='parametersPanel'>
            <div class='importantText' ><span>Nodes parameters:</span></div></br>
            <div>
              <span class='leftSpan'>Size:</span><input type='text' onchange='sizeNodeChange(this)' value='10'><span> px</span></br>
              <span class='leftSpan'>Color:</span><input type='text' onchange='colorNodeChange(this)' value='black'></br>
            </div>
          </div>

          <div class='parametersPanel'>
            <div class='importantText'><span>Link parameters:</span></div></br>
            <div>
              <span class='leftSpan'>Size:</span><input type='text' onchange='sizeEdgeChange(this)' value='12'><span> px</span></br>
              <span class='leftSpan'>Color:</span><input type='text' onchange='colorEdgeChange(this)' value='lightGrey'></br>
              <span class='leftSpan'>Interpolate:</span><select onchange='interpolationChange(this)'>
                  <option value='cardinal'>cardinal</option>
                  <option value='linear'>linear</option>
                  <option value='basis'>basis</option>
                  <option value='stepBefore'>stepBefore</option>
                </select>
            </div>
          </div>

          <div class='parametersPanel'>
            <div class='importantText'><span>Particules parameters:</span></div></br>

            <span class='leftSpan'>Height:</span><input type='text' onchange='heightParticuleChange(this)' value='3'><span> px</span></br>
            <span class='leftSpan'>Color:</span><input type='text' onchange='colorParticuleChange(this)' value='black'></br>
            <span class='leftSpan'>Speed:</span><input type='text' onchange='speedParticuleChange(this)' value='150'><span> px/s</span></br>
            <span class='leftSpan' style='margin-top: 30px;'>Frequency:</span><input id='frequency' type='text' onchange='frequencyParticuleChange(this)' value='1'><span id='unit'> Hz</span></br>
            <i class='fa fa-warning' style='font-size:20px'></i><span id='warningFreq'> number of particules that are fired each second! </span></br></br>
            <span class='leftSpan' style='margin-bottom: 8px;'>Spacing:</span><input id='spacing' type='text' onchange='spacingParticuleChange(this)' value='100'><span> px</span></br>
            <i class='fa fa-warning' style='font-size:20px'></i><span id='warningFreq'> space between two particules </span></br></br></br>

            <span class='leftSpan'>Pattern:</span><input type='text' value='[10,10]' onchange='patternParticuleChange(this)'></br>
          </div>


          <div class='parametersPanel'>
            <div class='importantText'><span>Animation parameters:</span></div></br>
            <span style='margin-left: 25px; margin-right: 5px;'>FPS limitation:</span><input type='text' value='auto' onchange='fpsLimitation(this)'></br></br>
            <input style='margin-left: 50px;' type='button' onclick='startAnimation(this)' value='start'></input>
            <input type='button' onclick='stopAnimation(this)' value='stop'></input>
            <input type='button' onclick='resetAnimation(this)' value='reset'></input>
          </div>

        </div>
      </div>
      <svg id=canvas class='rightContainer'></svg>
    </div>
  </body>

	<script>

  function fire1(){
    launcher = flownetGraph.particule_launcher('0')
    .prepare_particule()
    .particules('id','toast')
    .particules('height',10)
    .particules('color','blue')
    .particules('pattern',[20,3,20])
    .particules('speed',200)
    .particules('delay',0)
    .load_particule()
    .fire_particule()

    console.log(launcher);
  }

  function fire2(){
    launcher = flownetGraph.particule_launcher('0')
    .prepare_particule([{id:'f1',delay:0,speed:50},{id:'f2',delay:2000, speed:250}])
    .particules('id',function(d,i){return d.id})
    .particules('height',10)
    .particules('color','blue')
    .particules('pattern',[20,3,20])
    .particules('speed',function(d,i){return d.speed})
    .particules('delay',function(d,i){return d.delay})
    .on_start(function(d,i){ console.log(d.id,i);})
    .on_end(function(d,i){ console.log(d.id,i);})
    .load_particule()
    .fire_particule()

    console.log(launcher);
  }

  function sizeNodeChange(d){
    flownetGraph.nodes_properties('size', Number(d.value))
  }
  function colorNodeChange(d){
    flownetGraph.nodes_properties('color', d.value)
  }


  function sizeEdgeChange(d){
      flownetGraph.links_properties('size', d.value)
  }
  function colorEdgeChange(d){
    flownetGraph.links_properties('color', d.value)
  }
  function interpolationChange(d){
    flownetGraph.links_properties('interpolation', d.value)
  }


  function colorParticuleChange(d){
    flownetGraph.particules('color', d.value)
  }
  function heightParticuleChange(d){
    flownetGraph.particules('height', d.value)
  }
  function widthParticuleChange(d){
    flownetGraph.particules('width', d.value)
  }
  function modelParticuleChange(d){
    switch (d.value) {
      case 'frequencyToWidth':
        document.getElementById('width').disabled = true
        document.getElementById('frequency').disabled = false
        document.getElementById('unit').innerHTML = ' px'
        document.getElementById('warningFreq').innerHTML = ' distance between two patterns of particules (px) '
        break;
      case 'widthToFrequency':
        document.getElementById('width').disabled = false
        document.getElementById('frequency').disabled = true
        document.getElementById('unit').innerHTML = ' px'
        document.getElementById('warningFreq').innerHTML = ' distance between two patterns of particules (px) '
        break;
      case 'none':
        document.getElementById('width').disabled = false
        document.getElementById('frequency').disabled = false
        document.getElementById('unit').innerHTML = ' px'
        document.getElementById('warningFreq').innerHTML = ' distance between two patterns of particules (px) '
        break;
      case 'physical':
        document.getElementById('width').disabled = false
        document.getElementById('frequency').disabled = false
        document.getElementById('unit').innerHTML = ' Hz'
        document.getElementById('warningFreq').innerHTML = ' number of particules that are fired each second! '
        break;
      default:

    }
    flownetGraph.particules('computationalMethod', d.value)
  }
  function patternParticuleChange(d){
    flownetGraph.particules('pattern', JSON.parse(d.value))
  }
  function modelPatternChange(d){
    flownetGraph.particules('patternType', d.value)
  }
  function frequencyParticuleChange(d){
    flownetGraph.particules('frequency',d.value)
  }
  function spacingParticuleChange(d){
    flownetGraph.particules('spacing',d.value)
  }
  function speedParticuleChange(d){
    flownetGraph.particules('speed', d.value)
  }
  function fpsLimitation(d){
    if ( d.value === 'auto') flownetGraph.fps(d.value)
    else flownetGraph.fps(Number(d.value))
  }
  function startAnimation(d){
    flownetGraph.start()
  }
  function stopAnimation(d){
    flownetGraph.stop()
  }
  function resetAnimation(d){
    flownetGraph.reset()
  }

var graph = {id:'showGraph',
  nodes:[
    { color:'black', size:10, id:0},
    { color:'black', size:10, id:1},
    { color:'black', size:10, id:2},
    { color:'black', size:10, id:'node3'},
    { color:'black', size:10, id:4}
  ],
  links:[
    {source:0 , target:1 ,
      heightGate:{height:6, position:'60%'},colorGate2:{color:'red', position:'80%'}, colorGate1:{color:'blue', position:'35%'}, modele:'physical', id:0,
    points:[{x:450-100,y:50+300},{x:650-100,y:400+300},{x:850-100,y:50+300}], interpolation:'cardinal', colorLink:'lightGrey',
    sizeLink:12, colorParticule:'black', widthParticule:20, heightParticule:3,
    patternParticule:[10,10], patternType:'absolute', frequencyParticule:1, speedParticule:150},

    {source:1 , target:2 ,
      heightGate:{height:6, position:'60%'},colorGate2:{color:'red', position:'80%'}, colorGate1:{color:'blue', position:'35%'}, modele:'physical', id:'filter1',
    points:[], interpolation:'cardinal', colorLink:'lightGrey', sizeLink:12, colorParticule:'black',
    widthParticule:20, heightParticule:3,
    patternParticule:[10,10], patternType:'absolute', frequencyParticule:1, speedParticule:150},

    {source:1 , target:'node3' ,
      heightGate:{height:6, position:'60%'},colorGate2:{color:'red', position:'80%'}, colorGate1:{color:'blue', position:'35%'}, modele:'physical', id:'link2',
    points:[], interpolation:'cardinal', colorLink:'lightGrey', sizeLink:12, colorParticule:'black',
    widthParticule:20, heightParticule:3,
    patternParticule:[10,10], patternType:'absolute', frequencyParticule:1, speedParticule:150},

    {source:1 , target:4 ,
      heightGate:{height:6, position:'60%'},colorGate2:{color:'red', position:'80%'}, colorGate1:{color:'blue', position:'35%'}, modele:'physical', id:'filter3',
    points:[], interpolation:'cardinal', colorLink:'lightGrey', sizeLink:12, colorParticule:'black',
    widthParticule:20, heightParticule:3,
    patternParticule:[10,2,20], patternType:'absolute', frequencyParticule:1, speedParticule:150}
  ]
}

var graphExtension = {
  nodes:[
    {x:250-100 , y:500+300, color:'black', size:10, id:5}
  ],
  links:[
    {id:4,
    points:[{x:250-100,y:200+300},{x:250-100,y:500+300}], interpolation:'cardinal', colorLink:'lightGrey',
    sizeLink:12, colorParticule:'black', widthParticule:20, heightParticule:3,
    patternParticule:[10,10], patternType:'absolute', frequencyParticule:1, speedParticule:150}
  ]
}

graph.nodes = []
graph.links = []
var n = 10;
var m = 10;

graph.nodes = d3.range(n).map(function (a, i) { return { color:'black', size:10, id:i} });
    list  = randomChoose(unorderedPairs(d3.range(n)), m),
graph.links = list.map(function (a, i) { return     {source:a[0] , target:a[1] , modele:'physical', id:i,
        points:[], interpolation:'cardinal', colorLink:'lightGrey', sizeLink:12, colorParticule:'black',
        widthParticule:20, heightParticule:3,
        patternParticule:[10,2,20], patternType:'absolute', frequencyParticule:1, speedParticule:150} });

  console.log(graph.nodes);

  flownetGraph = flownet.graph("#canvas")
    //.graph(graph)
    .nodes(graph.nodes)
    .links(graph.links)
    //.node_properties('x', function(d, i){  return d.x})
    //.node_properties('y', function(d, i){  return d.y})
    .node_properties('color', function(d, i){ return d.color})
    .node_properties('size', function(d, i){  return d.size})

     .node_properties('label_text', function(d, i){  return 'id:'+d.id})
     .node_properties('label_size', 16)
    // .node_properties('label_x', function(d, i){  return d.x+10})
    // .node_properties('label_y', function(d, i){  return d.y-10})
     .node_properties('label_font', 'arial')
     .node_properties('label_color', 'black')
    // .node_properties('class', function(d, i){ return d.cssClass})
    /*.nodes_behaviors('mouseover', function(d1,i){
      flownetGraph.nodes_properties('color', 'blue', function(d2,i){
        return d1.id === d2.id
      })
    })*/
    //.nodes_properties('shape', 'circle') //rectangle, src=img/house
    //.nodes_properties('visibility', 'hidden')

     //.link_properties('points', function(d,i){ return d.points})
     .link_properties('interpolation', function(d,i){ return d.interpolation})
     .link_properties('color', function(d,i){ return d.colorLink})
     .link_properties('size', function(d,i){ return d.sizeLink})
//     /*.links_behaviors('mouseover', function(d1,i){
//       flownetGraph.links_properties('color', 'blue', function(d2,i){
//         return d1.id === d2.id
//       })
//     })*/
//     //.links_properties('visibility', 'hidden')
//
     .particules('color', function(d,i){ return d.colorParticule})
//     .particules('width', function(d,i){ return d.widthParticule})
     .particules('spacing',function(d,i){ return 10})
     .particules('height', function(d,i){ return d.heightParticule})
//   //  .particules('computationalMethod', function(d,i){ return d.modele})
     .particules('visual_pattern', function(d,i){ return [10,2,10]})
// //    .particules('patternType', function(d,i){ return d.patternType})
     .particules('speed', function(d,i){ return 144})
    .force_layout("2000", {x:750,y:500})

    /*.particule_behaviors('mouseover', function(d1,i){
      console.log(this);
      flownetGraph.particules('color', 'blue', function(d2,i){
        return d1.id === d2.id
      })
    })
    */
    //.link_add_gate('color', function(d){ return d.colorGate2.color}, function(d){ return d.colorGate2.position} )
    //.link_add_gate('height', function(d){ return d.heightGate.height}, function(d){ return d.heightGate.position} )
    //.link_add_gate('color', function(d){ return d.colorGate1.color}, function(d){ return d.colorGate1.position} )
    //.fps('auto')
    //.start()
    //.stop()
    //console.log(flownetGraph.selectAll('g'))

      //.remove()
      //.start()
/*
    flownetGraph.nodes(graphExtension.nodes)
      .links(graphExtension.links)
      .nodes_properties('x', function(d, i){  return d.x})
      .nodes_properties('y', function(d, i){  return d.y})
      .nodes_properties('color', function(d, i){ return d.color})
      .nodes_properties('size', function(d, i){  return d.size})

      .nodes_properties('label_text',function(d, i){  return 'id:'+d.id})
      .nodes_properties('label_size', 16)
      .nodes_properties('label_x', function(d, i){  return d.x+10})
      .nodes_properties('label_y', function(d, i){  return d.y-10})
      .nodes_properties('label_font', 'arial')
      .nodes_properties('label_color', 'black')
      //.nodes_properties('class', function(d, i){ return d.cssClass})

      //.nodes_properties('shape', 'circle') //rectangle, src=img/house
      //.nodes_properties('visibility', 'hidden')

      .links_properties('points', function(d,i){ return d.points})
      .links_properties('interpolation', function(d,i){ return d.interpolation})
      .links_properties('color', function(d,i){ return d.colorLink})
      .links_properties('size', function(d,i){ return d.sizeLink})


      .particules('color', function(d,i){ return d.colorParticule})
      .particules('width', function(d,i){ return d.widthParticule})
      .particules('height', function(d,i){ return d.heightParticule})
      .particules('frequency',function(d,i){ return d.frequencyParticule})
    //  .particules('computationalMethod', function(d,i){ return d.modele})
//      .particules('pattern', function(d,i){ return d.patternParticule})
  //    .particules('patternType', function(d,i){ return d.patternType})
//      .particules('speed', function(d,i){ return d.speedParticule})


/*
  d3.select('svg').append('g').selectAll('circle')
    .data([{x:450-100,y:50+300},{x:650-100,y:400+300},{x:850-100,y:50+300}])
    .enter()
    .append('circle')
    .attr('id', function(d,i){ return 'circle'+i})
    .attr('cx', function(d){ console.log(d.x);return d.x})
    .attr('cy', function(d){ return d.y})
    .attr('r', 8)
    .attr('fill', 'black' )
    .attr('opacity', '0.5')
    .call(d3.drag()
      .on('start', function(){
        this.setAttribute('ex', d3.event.x)
        this.setAttribute('ey', d3.event.y)
      })
      .on('drag', function(d,i){
        this.setAttribute('cx', Number(this.getAttribute('cx'))+d3.event.x-Number(this.getAttribute('ex')))
        this.setAttribute('cy', Number(this.getAttribute('cy'))+d3.event.y-Number(this.getAttribute('ey')))
        this.setAttribute('ex', d3.event.x)
        this.setAttribute('ey', d3.event.y)
        graph.links[0].points.splice(i+1, 1, {x:this.getAttribute('cx'), y:this.getAttribute('cy')})
        flownetGraph.links_properties('points', function(d){ return d.points})
      })
      .on('end', function(){}));*/

            function randomChoose (s, k) { // returns a random k element subset of s
        var a = [], i = -1, j;
        while (++i < k) {
          j = Math.floor(Math.random() * s.length);
          a.push(s.splice(j, 1)[0]);
        };
        return a;
      }

      function unorderedPairs (s) { // returns the list of all unordered pairs from s
        var i = -1, a = [], j;
        while (++i < s.length) {
          j = i;
          while (++j < s.length) a.push([s[i],s[j]])
        };
        return a;
      }

	</script>



</html>
